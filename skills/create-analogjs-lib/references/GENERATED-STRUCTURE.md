# Generated Library Structure

Complete reference for the directory structure generated by `@analog-tools/generator:library` with various option combinations.

**Note:** tRPC support is legacy. Only include `--trpc` when the user explicitly asks for it.

## Table of Contents

- [Minimal Library (No Options)](#minimal-library-no-options)
- [With Pages](#with-pages)
- [With API Routes](#with-api-routes)
- [With tRPC (Legacy)](#with-trpc-legacy)
- [With Content Routes](#with-content-routes)
- [All Features Enabled](#all-features-enabled)
- [File Descriptions](#file-descriptions)

---

## Minimal Library (No Options)

```
libs/my-feature/
├── src/
│   ├── index.ts                           # Public API barrel
│   ├── test-setup.ts                      # Vitest configuration
│   └── lib/
│       ├── components/                    # Angular components
│       │   └── my-feature.component.ts
│       └── services/                      # Shared services
│           └── my-feature.service.ts
├── eslint.config.cjs
├── package.json
├── project.json
├── README.md
├── tsconfig.json
├── tsconfig.lib.json
├── tsconfig.spec.json
└── vite.config.mts
```

**Use for:** UI components, shared utilities, domain logic (no pages, no backend).

---

## With Pages

```
libs/my-feature/
├── src/
│   ├── index.ts
│   ├── test-setup.ts
│   ├── lib/
│   │   ├── components/
│   │   │   └── my-feature.component.ts
│   │   └── services/
│   │       └── my-feature.service.ts
│   └── pages/                             # ✨ File-based routes
│       └── my-feature/
│           ├── my-feature.page.ts         # Routable page component
│           └── (my-feature).page.ts       # Layout wrapper
├── eslint.config.cjs
├── package.json
├── project.json
├── README.md
├── tsconfig.json
├── tsconfig.lib.json
├── tsconfig.spec.json
└── vite.config.mts
```

**Route mapping:**
- `my-feature.page.ts` → `/my-feature`
- `(my-feature).page.ts` → Layout route (wraps child routes)

**Use for:** Features with UI pages, routes, navigation.

---

## With API Routes

```
libs/my-feature/
├── src/
│   ├── index.ts
│   ├── test-setup.ts
│   ├── lib/
│   │   ├── components/
│   │   │   └── my-feature.component.ts
│   │   └── services/
│   │       └── my-feature.service.ts
│   ├── models/                            # ✨ Data models (optional)
│   │   └── my-feature.model.ts
│   └── backend/                           # ✨ Backend folder
│       ├── index.ts                       # Backend barrel export
│       └── api/
│           └── routes/api/my-feature/
│               └── hello.ts               # REST endpoint handler
├── eslint.config.cjs
├── package.json
├── project.json
├── README.md
├── tsconfig.json
├── tsconfig.lib.json
├── tsconfig.spec.json
└── vite.config.mts
```

**Route mapping:**
- `hello.ts` → `GET /api/my-feature/hello`
- `hello.post.ts` → `POST /api/my-feature/hello`
- `users/[id].get.ts` → `GET /api/my-feature/users/:id`

**Use for:** REST APIs, backend services, data endpoints.

---

## With tRPC (Legacy)

Only use this option when the user explicitly asks for tRPC.

```
libs/my-feature/
├── src/
│   ├── index.ts
│   ├── test-setup.ts
│   ├── lib/
│   │   ├── components/
│   │   │   └── my-feature.component.ts
│   │   └── services/
│   │       └── my-feature.service.ts
│   └── backend/                           # ✨ Backend folder
│       ├── index.ts
│       ├── api/
│       │   └── routes/api/my-feature/
│       │       └── hello.ts
│       └── trpc/                          # ✨ tRPC infrastructure
│           ├── context.ts                 # Request context
│           ├── trpc.ts                    # tRPC router setup
│           ├── trpc-client.ts             # Frontend client
│           └── routers/
│               ├── index.ts               # Main router (combines sub-routers)
│               └── my-feature.ts          # Feature router
├── eslint.config.cjs
├── package.json
├── project.json
├── README.md
├── tsconfig.json
├── tsconfig.lib.json
├── tsconfig.spec.json
└── vite.config.mts
```

**Key files:**

| File | Purpose |
|------|---------|
| `trpc.ts` | Initialize tRPC Router and Procedure |
| `context.ts` | Build request context (auth, db, etc.) |
| `routers/my-feature.ts` | Define tRPC routes (queries, mutations) |
| `routers/index.ts` | Combine routers, export AppRouter type |
| `trpc-client.ts` | Frontend client for type-safe RPC calls |

**Use for:** Type-safe RPC, fullstack features with type inference (legacy).

---

## With Content Routes

```
libs/my-feature/
├── src/
│   ├── index.ts
│   ├── test-setup.ts
│   ├── lib/
│   │   ├── components/
│   │   │   └── my-feature.component.ts
│   │   └── services/
│   │       └── my-feature.service.ts
│   └── content/                           # ✨ Markdown content directory
│       └── my-feature/
│           ├── example-post.md
│           ├── another-post.md
│           └── ...
├── eslint.config.cjs
├── package.json
├── project.json
├── README.md
├── tsconfig.json
├── tsconfig.lib.json
├── tsconfig.spec.json
└── vite.config.mts
```

**Content discovery:**
- AnalogJS content API discovers `.md` files in `src/content/`
- Frontmatter (YAML) in markdown parsed as metadata

**Use for:** Blog, documentation, content-driven features.

---

## All Features Enabled

This includes tRPC (legacy). Only include tRPC when explicitly requested.

```
libs/my-feature/
├── src/
│   ├── index.ts
│   ├── test-setup.ts
│   ├── lib/
│   │   ├── components/
│   │   │   └── my-feature.component.ts
│   │   └── services/
│   │       └── my-feature.service.ts
│   ├── models/
│   │   └── my-feature.model.ts
│   ├── pages/
│   │   └── my-feature/
│   │       ├── my-feature.page.ts
│   │       └── (my-feature).page.ts
│   ├── content/
│   │   └── my-feature/
│   │       ├── example-post.md
│   │       └── another-post.md
│   └── backend/
│       ├── index.ts
│       ├── api/
│       │   └── routes/api/my-feature/
│       │       └── hello.ts
│       └── trpc/
│           ├── context.ts
│           ├── trpc.ts
│           ├── trpc-client.ts
│           └── routers/
│               ├── index.ts
│               └── my-feature.ts
├── eslint.config.cjs
├── package.json
├── project.json
├── README.md
├── tsconfig.json
├── tsconfig.lib.json
├── tsconfig.spec.json
└── vite.config.mts
```

---

## File Descriptions

### Core Files

| File | Purpose |
|------|---------|
| `src/index.ts` | **Public API barrel** -- exports all public symbols. Update this as you add exports. |
| `src/test-setup.ts` | Vitest setup, test utilities. Import in test files. |
| `package.json` | NPM metadata, dependencies (auto-updated by generator). |
| `project.json` | Nx configuration (targets, metadata). |
| `tsconfig.json` | Root TypeScript config for the library. |
| `tsconfig.lib.json` | Library build configuration (extends `tsconfig.json`). |
| `tsconfig.spec.json` | Test configuration (extends `tsconfig.json`). |
| `vite.config.mts` | Build configuration (Vite/Vitest). |
| `eslint.config.cjs` | ESLint rules for the library. |
| `README.md` | Library documentation. |

### Frontend (Pages & Components)

| Directory | Purpose |
|-----------|---------|
| `src/lib/components/` | Reusable Angular components. |
| `src/lib/services/` | Shared services (dependency injection). |
| `src/pages/` | File-based routing pages (if `--pages=true`). |

**Pages Naming Convention:**
- `*.page.ts` -- Route component (routable)
- `(name).page.ts` -- Layout component (groups routes)

### Backend (API & tRPC)

| Directory | Purpose |
|-----------|---------|
| `src/backend/index.ts` | Backend barrel export (queries, mutations, router). |
| `src/backend/api/routes/api/` | REST endpoints (H3 event handlers). |
| `src/backend/trpc/` | tRPC server setup and routers (legacy, explicit request only). |
| `src/backend/trpc/context.ts` | Request context builder (legacy). |
| `src/backend/trpc/trpc.ts` | tRPC router and procedure initialization (legacy). |
| `src/backend/trpc/trpc-client.ts` | Frontend-safe tRPC client (legacy). |
| `src/backend/trpc/routers/` | tRPC router definitions (legacy). |
| `src/models/` | TypeScript types/interfaces for data. |

### Content

| Directory | Purpose |
|-----------|---------|
| `src/content/` | Markdown files (discoverable by AnalogJS). |

---

## Generated vs. Custom Files

The generator creates **example files** by default. You can:

1. **Use the examples** as templates, then customize them.
2. **Delete examples** and write your own.
3. **Skip examples** with `--skipExamples=true` (creates empty dirs with `.gitkeep`).

### Example Files (Created by Generator)

- `src/lib/components/my-feature.component.ts`
- `src/lib/services/my-feature.service.ts`
- `src/pages/my-feature/*.page.ts` (if `--pages=true`)
- `src/backend/api/routes/api/my-feature/hello.ts` (if `--api=true`)
- `src/backend/trpc/routers/my-feature.ts` (if `--trpc=true`, legacy)
- `src/content/my-feature/example-post.md` (if `--contentRoutes=true`)

### Files You Must Maintain

- `src/index.ts` -- Keep barrel exports up-to-date
- `src/backend/index.ts` -- Export public backend APIs (routers, etc.)
- `src/backend/trpc/routers/index.ts` -- Combine sub-routers for AppRouter type
